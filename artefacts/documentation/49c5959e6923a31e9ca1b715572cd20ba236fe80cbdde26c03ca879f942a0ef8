 TODO: find a way to get max channels