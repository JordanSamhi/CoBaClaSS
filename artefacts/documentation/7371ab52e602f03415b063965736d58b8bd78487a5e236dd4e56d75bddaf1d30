 TODO: Extract the shared filtering logic here and in FillUi to a common method.