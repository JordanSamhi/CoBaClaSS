
     * Wait until the one of the desired {@code states} is observed, checking all
     * state transitions since the last time a state was waited on.
     *
     * <p>Any intermediate state transitions that are not in {@code states} are ignored.</p>
     *
     * <p>Note: Only one waiter allowed at a time!</p>
     *
     * @param states Set of desired states to observe a transition to.
     * @param timeoutMs how long to wait in milliseconds
     *
     * @return the state reached
     *
     * @throws IllegalArgumentException if {@code state} was out of range
     * @throws TimeoutRuntimeException if none of the states is observed before timeout.
     * @throws IllegalStateException if another thread is already waiting for a state transition
     