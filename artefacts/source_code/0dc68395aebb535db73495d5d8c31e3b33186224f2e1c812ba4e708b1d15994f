public void runJobSync(final Runnable job, Object waitLock, long timeoutMs, String jobMsg){
    String timeoutMsg = "Timeout waiting " + timeoutMs + "ms for " + jobMsg;
    synchronized (waitLock) {
        long timeoutBound = SystemClock.uptimeMillis() + timeoutMs;
        try {
            runJob(job);
            waitLock.wait(timeoutMs);
            if (SystemClock.uptimeMillis() > timeoutBound) {
                throw new IllegalStateException(timeoutMsg);
            }
        } catch (InterruptedException ex) {
            if (SystemClock.uptimeMillis() > timeoutBound) {
                throw new IllegalStateException(timeoutMsg);
            }
        }
    }
}