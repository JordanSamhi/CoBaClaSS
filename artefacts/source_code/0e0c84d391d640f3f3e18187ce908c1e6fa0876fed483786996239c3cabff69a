public final boolean enableShutterSound(boolean enabled){
    boolean canDisableShutterSound = true;
    IBinder b = ServiceManager.getService(Context.AUDIO_SERVICE);
    IAudioService audioService = IAudioService.Stub.asInterface(b);
    try {
        if (audioService.isCameraSoundForced()) {
            canDisableShutterSound = false;
        }
    } catch (RemoteException e) {
        Log.e(TAG, "Audio service is unavailable for queries");
    }
    if (!enabled && !canDisableShutterSound) {
        return false;
    }
    synchronized (mShutterSoundLock) {
        mShutterSoundEnabledFromApp = enabled;
        boolean ret = _enableShutterSound(enabled);
        if (enabled && !mHasAppOpsPlayAudio) {
            Log.i(TAG, "Shutter sound is not allowed by AppOpsManager");
            if (canDisableShutterSound) {
                _enableShutterSound(false);
            }
        }
        return ret;
    }
}