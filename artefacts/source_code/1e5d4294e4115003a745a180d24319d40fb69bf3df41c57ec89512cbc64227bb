public void handleConnectionStateChanged(int state){
    localLog("handleConnectionStateChanged: state=" + stateToString(state));
    if (mConnectedSingleScanScheduleSec == null) {
        mConnectedSingleScanScheduleSec = initializeScanningSchedule(WIFI_STATE_CONNECTED);
    }
    if (mDisconnectedSingleScanScheduleSec == null) {
        mDisconnectedSingleScanScheduleSec = initializeScanningSchedule(WIFI_STATE_DISCONNECTED);
    }
    if (mConnectedSingleSavedNetworkSingleScanScheduleSec == null) {
        mConnectedSingleSavedNetworkSingleScanScheduleSec = initSingleSavedNetworkSchedule();
        if (mConnectedSingleSavedNetworkSingleScanScheduleSec == null) {
            mConnectedSingleSavedNetworkSingleScanScheduleSec = mConnectedSingleScanScheduleSec;
        }
    }
    mWifiState = state;
    if (mWifiState == WIFI_STATE_DISCONNECTED) {
        mLastConnectionAttemptBssid = null;
        scheduleWatchdogTimer();
        setSingleScanningSchedule(mDisconnectedSingleScanScheduleSec);
        startConnectivityScan(SCAN_IMMEDIATELY);
    } else if (mWifiState == WIFI_STATE_CONNECTED) {
        if (useSingleSavedNetworkSchedule()) {
            setSingleScanningSchedule(mConnectedSingleSavedNetworkSingleScanScheduleSec);
        } else {
            setSingleScanningSchedule(mConnectedSingleScanScheduleSec);
        }
        startConnectivityScan(SCAN_ON_SCHEDULE);
    } else {
        setSingleScanningSchedule(null);
        startConnectivityScan(SCAN_ON_SCHEDULE);
    }
}