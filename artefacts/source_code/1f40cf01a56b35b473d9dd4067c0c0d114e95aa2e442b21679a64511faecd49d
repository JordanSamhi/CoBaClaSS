public int onCommand(BasicShellCommandHandler parentShell){
    final PrintWriter pw = parentShell.getErrPrintWriter();
    String subCmd = parentShell.getNextArgRequired();
    if (VDBG)
        Log.v(TAG, "onCommand: subCmd='" + subCmd + "'");
    switch(subCmd) {
        case "set":
            {
                String name = parentShell.getNextArgRequired();
                if (VDBG)
                    Log.v(TAG, "onCommand: name='" + name + "'");
                if (!mSettableParameters.containsKey(name)) {
                    pw.println("Unknown parameter name -- '" + name + "'");
                    return -1;
                }
                String valueStr = parentShell.getNextArgRequired();
                if (VDBG)
                    Log.v(TAG, "onCommand: valueStr='" + valueStr + "'");
                int value;
                try {
                    value = Integer.valueOf(valueStr);
                } catch (NumberFormatException e) {
                    pw.println("Can't convert value to integer -- '" + valueStr + "'");
                    return -1;
                }
                mSettableParameters.put(name, value);
                return 0;
            }
        case "set-power":
            {
                String mode = parentShell.getNextArgRequired();
                String name = parentShell.getNextArgRequired();
                String valueStr = parentShell.getNextArgRequired();
                if (VDBG) {
                    Log.v(TAG, "onCommand: mode='" + mode + "', name='" + name + "'" + ", value='" + valueStr + "'");
                }
                if (!mSettablePowerParameters.containsKey(mode)) {
                    pw.println("Unknown mode name -- '" + mode + "'");
                    return -1;
                }
                if (!mSettablePowerParameters.get(mode).containsKey(name)) {
                    pw.println("Unknown parameter name '" + name + "' in mode '" + mode + "'");
                    return -1;
                }
                int value;
                try {
                    value = Integer.valueOf(valueStr);
                } catch (NumberFormatException e) {
                    pw.println("Can't convert value to integer -- '" + valueStr + "'");
                    return -1;
                }
                mSettablePowerParameters.get(mode).put(name, value);
                return 0;
            }
        case "get":
            {
                String name = parentShell.getNextArgRequired();
                if (VDBG)
                    Log.v(TAG, "onCommand: name='" + name + "'");
                if (!mSettableParameters.containsKey(name)) {
                    pw.println("Unknown parameter name -- '" + name + "'");
                    return -1;
                }
                parentShell.getOutPrintWriter().println((int) mSettableParameters.get(name));
                return 0;
            }
        case "get-power":
            {
                String mode = parentShell.getNextArgRequired();
                String name = parentShell.getNextArgRequired();
                if (VDBG)
                    Log.v(TAG, "onCommand: mode='" + mode + "', name='" + name + "'");
                if (!mSettablePowerParameters.containsKey(mode)) {
                    pw.println("Unknown mode -- '" + mode + "'");
                    return -1;
                }
                if (!mSettablePowerParameters.get(mode).containsKey(name)) {
                    pw.println("Unknown parameter name -- '" + name + "' in mode '" + mode + "'");
                    return -1;
                }
                parentShell.getOutPrintWriter().println((int) mSettablePowerParameters.get(mode).get(name));
                return 0;
            }
        default:
            pw.println("Unknown 'wifiaware native_api <cmd>'");
    }
    return -1;
}