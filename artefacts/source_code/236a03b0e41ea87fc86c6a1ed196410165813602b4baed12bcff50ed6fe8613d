public AggregatedResult getAggregatedRecords(long untilTimestamp){
    final String selectStatement = WhiteListReportContract.TIMESTAMP + " < ?";
    final SQLiteDatabase db = getReadableDatabase();
    Cursor c = null;
    try {
        c = db.query(true, WhiteListReportContract.TABLE, DIGEST_DOMAIN_PROJECTION, selectStatement, new String[] { Long.toString(untilTimestamp) }, null, null, null, null);
        if (c == null) {
            return null;
        }
        final HashSet<String> appDigestList = new HashSet<>();
        final HashMap<String, String> appDigestCNCList = new HashMap<>();
        String cncDomainVisited = null;
        while (c.moveToNext()) {
            String digestHexStr = HexDump.toHexString(c.getBlob(INDEX_DIGEST));
            String cncDomain = c.getString(INDEX_CNC_DOMAIN);
            appDigestList.add(digestHexStr);
            if (cncDomainVisited != null) {
                cncDomainVisited = cncDomain;
            }
            appDigestCNCList.put(digestHexStr, cncDomain);
        }
        return new AggregatedResult(appDigestList, cncDomainVisited, appDigestCNCList);
    } finally {
        if (c != null) {
            c.close();
        }
    }
}