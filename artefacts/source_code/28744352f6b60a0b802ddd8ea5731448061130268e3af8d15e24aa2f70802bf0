public synchronized NetworkCapabilities updateCapabilities(@Nullable Network defaultNetwork){
    if (mConfig == null) {
        return null;
    }
    Network[] underlyingNetworks = mConfig.underlyingNetworks;
    if (underlyingNetworks == null && defaultNetwork != null) {
        underlyingNetworks = new Network[] { defaultNetwork };
    }
    final boolean isAlwaysMetered = mIsPackageTargetingAtLeastQ && mConfig.isMetered;
    applyUnderlyingCapabilities(mContext.getSystemService(ConnectivityManager.class), underlyingNetworks, mNetworkCapabilities, isAlwaysMetered);
    return new NetworkCapabilities(mNetworkCapabilities);
}