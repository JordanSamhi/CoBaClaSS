public int nextField() throws IOException{
    if ((mState & STATE_FIELD_MISS) == STATE_FIELD_MISS) {
        mState &= ~STATE_FIELD_MISS;
        return mFieldNumber;
    }
    if ((mState & STATE_STARTED_FIELD_READ) == STATE_STARTED_FIELD_READ) {
        skip();
        mState &= ~STATE_STARTED_FIELD_READ;
    }
    if ((mState & STATE_READING_PACKED) == STATE_READING_PACKED) {
        if (getOffset() < mPackedEnd) {
            mState |= STATE_STARTED_FIELD_READ;
            return mFieldNumber;
        } else if (getOffset() == mPackedEnd) {
            mState &= ~STATE_READING_PACKED;
        } else {
            throw new ProtoParseException("Unexpectedly reached end of packed field at offset 0x" + Integer.toHexString(mPackedEnd) + dumpDebugData());
        }
    }
    if ((mDepth >= 0) && (getOffset() == getOffsetFromToken(mExpectedObjectTokenStack.get(mDepth)))) {
        mFieldNumber = NO_MORE_FIELDS;
    } else {
        readTag();
    }
    return mFieldNumber;
}