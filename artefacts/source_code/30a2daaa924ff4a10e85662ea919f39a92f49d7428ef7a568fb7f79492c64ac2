public static boolean appIsRunningAndEligibleForBackupWithTransport(@Nullable TransportClient transportClient, String packageName, PackageManager pm, int userId){
    try {
        PackageInfo packageInfo = pm.getPackageInfoAsUser(packageName, PackageManager.GET_SIGNING_CERTIFICATES, userId);
        ApplicationInfo applicationInfo = packageInfo.applicationInfo;
        if (!appIsEligibleForBackup(applicationInfo, userId) || appIsStopped(applicationInfo) || appIsDisabled(applicationInfo, userId)) {
            return false;
        }
        if (transportClient != null) {
            try {
                IBackupTransport transport = transportClient.connectOrThrow("AppBackupUtils.appIsRunningAndEligibleForBackupWithTransport");
                return transport.isAppEligibleForBackup(packageInfo, AppBackupUtils.appGetsFullBackup(packageInfo));
            } catch (Exception e) {
                Slog.e(TAG, "Unable to ask about eligibility: " + e.getMessage());
            }
        }
        return true;
    } catch (PackageManager.NameNotFoundException e) {
        return false;
    }
}