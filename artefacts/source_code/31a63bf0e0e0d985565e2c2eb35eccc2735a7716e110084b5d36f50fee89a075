public void init(Handler handler){
    IntentFilter filter = new IntentFilter();
    filter.addAction(WifiManager.WIFI_STATE_CHANGED_ACTION);
    BroadcastReceiver receiver = new BroadcastReceiver() {

        @Override
        public void onReceive(Context context, Intent intent) {
            String action = intent.getAction();
            if (action.equals(WifiManager.WIFI_STATE_CHANGED_ACTION)) {
                int state = intent.getIntExtra(WifiManager.EXTRA_WIFI_STATE, WifiManager.WIFI_STATE_UNKNOWN);
                if (state == WifiManager.WIFI_STATE_DISABLED && mWifiEnabled) {
                    mWifiEnabled = false;
                    if (mCallbacks != null)
                        mCallbacks.onWifiDisabled();
                }
                if (state == WifiManager.WIFI_STATE_ENABLED && !mWifiEnabled) {
                    mWifiEnabled = true;
                    if (mCallbacks != null)
                        mCallbacks.onWifiEnabled();
                }
            }
        }
    };
    mWifiManager = (WifiManager) mContext.getSystemService(Context.WIFI_SERVICE);
    mContext.registerReceiver(receiver, filter, null, handler);
    mWifiEnabled = mWifiManager.isWifiEnabled();
    mConnectivityManager = (ConnectivityManager) mContext.getSystemService(Context.CONNECTIVITY_SERVICE);
    mConnectivityCallbacks = new ConnectivityCallbacks();
    mHandler = handler;
}