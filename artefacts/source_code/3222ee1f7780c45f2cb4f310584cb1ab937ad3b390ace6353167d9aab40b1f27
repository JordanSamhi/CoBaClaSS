public List<String> getCarrierPackageNamesForIntent(PackageManager packageManager, Intent intent){
    List<String> packages = new ArrayList<String>();
    List<ResolveInfo> receivers = new ArrayList<ResolveInfo>();
    receivers.addAll(packageManager.queryBroadcastReceivers(intent, 0));
    receivers.addAll(packageManager.queryIntentContentProviders(intent, 0));
    receivers.addAll(packageManager.queryIntentActivities(intent, 0));
    receivers.addAll(packageManager.queryIntentServices(intent, 0));
    for (ResolveInfo resolveInfo : receivers) {
        String packageName = getPackageName(resolveInfo);
        if (packageName == null) {
            continue;
        }
        int status = getCarrierPrivilegeStatus(packageManager, packageName);
        if (status == TelephonyManager.CARRIER_PRIVILEGE_STATUS_HAS_ACCESS) {
            packages.add(packageName);
        } else if (status != TelephonyManager.CARRIER_PRIVILEGE_STATUS_NO_ACCESS) {
            return null;
        }
    }
    return packages;
}