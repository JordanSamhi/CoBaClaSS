public static int messagesInLooper(Looper looper, Predicate<Message> messageFilter){
    MessageQueue queue = looper.getQueue();
    int i = 0;
    for (Message m = shadowOf(queue).getHead(); m != null; m = shadowOf(m).getNext()) {
        if (messageFilter.test(m)) {
            i += 1;
        }
    }
    return i;
}