public boolean checkAccessibilityAccess(AbstractAccessibilityServiceConnection service){
    final String packageName = service.getComponentName().getPackageName();
    final ResolveInfo resolveInfo = service.getServiceInfo().getResolveInfo();
    if (resolveInfo == null) {
        return true;
    }
    final int uid = resolveInfo.serviceInfo.applicationInfo.uid;
    final long identityToken = Binder.clearCallingIdentity();
    try {
        if (OWN_PROCESS_ID == Binder.getCallingPid()) {
            return mAppOpsManager.noteOpNoThrow(AppOpsManager.OPSTR_ACCESS_ACCESSIBILITY, uid, packageName) == AppOpsManager.MODE_ALLOWED;
        }
        return mAppOpsManager.noteOp(AppOpsManager.OPSTR_ACCESS_ACCESSIBILITY, uid, packageName) == AppOpsManager.MODE_ALLOWED;
    } finally {
        Binder.restoreCallingIdentity(identityToken);
    }
}