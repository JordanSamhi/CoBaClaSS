public static ArrayList<Byte> hidlMemoryToByteList(@NonNull HidlMemory mem){
    Preconditions.checkNotNull(mem);
    Preconditions.checkArgumentInRange(mem.getSize(), 0L, (long) Integer.MAX_VALUE, "Memory size");
    Preconditions.checkArgument(mem.getSize() == 0 || mem.getName().equals("ashmem"), "Unsupported memory type: %s", mem.getName());
    if (mem.getSize() == 0) {
        return new ArrayList<>();
    }
    ByteBuffer buffer = getBuffer(mem);
    ArrayList<Byte> result = new ArrayList<>(buffer.remaining());
    while (buffer.hasRemaining()) {
        result.add(buffer.get());
    }
    return result;
}