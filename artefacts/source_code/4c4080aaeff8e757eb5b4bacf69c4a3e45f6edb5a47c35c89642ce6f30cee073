public void testSelectBackupTransportAsync_whenTransportGetsUnregistered() throws Exception{
    setUpTransports(mTransportManager, mTransport.unregistered());
    ComponentName newTransportComponent = mTransport.getTransportComponent();
    mShadowContext.grantPermissions(android.Manifest.permission.BACKUP);
    when(mTransportManager.registerAndSelectTransport(eq(newTransportComponent))).thenReturn(BackupManager.SUCCESS);
    UserBackupManagerService backupManagerService = createUserBackupManagerServiceAndRunTasks();
    ISelectBackupTransportCallback callback = mock(ISelectBackupTransportCallback.class);
    backupManagerService.selectBackupTransportAsync(newTransportComponent, callback);
    mShadowBackupLooper.runToEndOfTasks();
    assertThat(getSettingsTransport()).isNotEqualTo(mTransportName);
    verify(callback).onFailure(anyInt());
}