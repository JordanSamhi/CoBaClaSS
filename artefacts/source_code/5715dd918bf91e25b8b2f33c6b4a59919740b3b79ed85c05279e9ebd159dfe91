public V put(@Nullable K key, @Nullable V value){
    if (mMap == null) {
        mMap = new ArrayMap<>();
    }
    ReferenceWithHistory<V> valueHolder = mMap.get(key);
    if (valueHolder == null) {
        valueHolder = new ReferenceWithHistory<>(mMaxHistorySize);
        mMap.put(key, valueHolder);
    } else if (valueHolder.getHistoryCount() == 0) {
        Log.w(TAG, "History for \"" + key + "\" was unexpectedly empty");
    }
    return valueHolder.set(value);
}