public void onMMIDone(ImsPhoneMmiCode mmi){
    logd("onMMIDone: mmi=" + mmi);
    if (mPendingMMIs.remove(mmi) || mmi.isUssdRequest() || mmi.isSsInfo()) {
        ResultReceiver receiverCallback = mmi.getUssdCallbackReceiver();
        if (receiverCallback != null) {
            int returnCode = (mmi.getState() == MmiCode.State.COMPLETE) ? TelephonyManager.USSD_RETURN_SUCCESS : TelephonyManager.USSD_RETURN_FAILURE;
            sendUssdResponse(mmi.getDialString(), mmi.getMessage(), returnCode, receiverCallback);
        } else {
            logv("onMMIDone: notifyRegistrants");
            mMmiCompleteRegistrants.notifyRegistrants(new AsyncResult(null, mmi, null));
        }
    }
}