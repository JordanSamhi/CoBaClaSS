public void isKeyRotationDue_neverAllowsMoreThanInWindow(){
    List<String> apps = makeTestApps(MAXIMUM_ROTATIONS_PER_WINDOW * MAX_BACKUPS_TILL_ROTATION);
    for (int i = 0; i < 300; i++) {
        setTimeMillis(i * TimeUnit.HOURS.toMillis(24));
        int rotationsThisNight = 0;
        for (String app : apps) {
            if (mScheduler.isKeyRotationDue(app)) {
                rotationsThisNight++;
                mScheduler.recordKeyRotation(app);
            } else {
                mScheduler.recordBackup(app);
            }
        }
        assertThat(rotationsThisNight).isAtMost(MAXIMUM_ROTATIONS_PER_WINDOW);
    }
}