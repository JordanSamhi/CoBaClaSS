public void pruneDataForUser(@UserIdInt int userId, @NonNull CancellationSignal signal){
    UserData userData = getUnlockedUserData(userId);
    if (userData == null || signal.isCanceled()) {
        return;
    }
    pruneUninstalledPackageData(userData);
    final NotificationListener notificationListener = mNotificationListeners.get(userId);
    userData.forAllPackages(packageData -> {
        if (signal.isCanceled()) {
            return;
        }
        packageData.getEventStore().pruneOldEvents();
        if (!packageData.isDefaultDialer()) {
            packageData.getEventStore().deleteEventHistories(EventStore.CATEGORY_CALL);
        }
        if (!packageData.isDefaultSmsApp()) {
            packageData.getEventStore().deleteEventHistories(EventStore.CATEGORY_SMS);
        }
        packageData.pruneOrphanEvents();
        if (notificationListener != null) {
            String packageName = packageData.getPackageName();
            packageData.forAllConversations(conversationInfo -> {
                if (conversationInfo.isShortcutCachedForNotification() && conversationInfo.getNotificationChannelId() == null && !notificationListener.hasActiveNotifications(packageName, conversationInfo.getShortcutId())) {
                    mShortcutServiceInternal.uncacheShortcuts(userId, mContext.getPackageName(), packageName, Collections.singletonList(conversationInfo.getShortcutId()), userId, ShortcutInfo.FLAG_CACHED_NOTIFICATIONS);
                }
            });
        }
    });
}