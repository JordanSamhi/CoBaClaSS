public void testBackupWidget_writesCorrectData() throws Exception{
    PackageInfo packageInfo = createPackageInfo(TEST_PACKAGE, TEST_PACKAGE_INSTALLER, TEST_PACKAGE_VERSION_CODE);
    File metadataFile = createFile(BACKUP_METADATA_FILENAME);
    byte[] widgetBytes = "widget".getBytes();
    mBackupWriter.backupWidget(packageInfo, metadataFile, mFilesDir, widgetBytes);
    byte[] writtenBytes = getWrittenBytes(mBackupDataOutputFile, false);
    String[] widgetData = new String(writtenBytes, StandardCharsets.UTF_8).split("\n");
    assertThat(widgetData.length).isEqualTo(3);
    assertThat(widgetData[0]).isEqualTo(Integer.toString(BACKUP_METADATA_VERSION));
    assertThat(widgetData[1]).isEqualTo(packageInfo.packageName);
    ByteArrayOutputStream expectedBytes = new ByteArrayOutputStream();
    DataOutputStream stream = new DataOutputStream(expectedBytes);
    stream.writeInt(BACKUP_WIDGET_METADATA_TOKEN);
    stream.writeInt(widgetBytes.length);
    stream.write(widgetBytes);
    stream.flush();
    assertThat(widgetData[2]).isEqualTo(expectedBytes.toString());
    metadataFile.delete();
}