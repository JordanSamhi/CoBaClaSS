public void setInAmbientMode(boolean inAmbientMode, long animationDuration){
    final IWallpaperEngine engine;
    synchronized (mLock) {
        mInAmbientMode = inAmbientMode;
        final WallpaperData data = mWallpaperMap.get(mCurrentUserId);
        if (data != null && data.connection != null && (data.connection.mInfo == null || data.connection.mInfo.supportsAmbientMode())) {
            engine = data.connection.getDisplayConnectorOrCreate(DEFAULT_DISPLAY).mEngine;
        } else {
            engine = null;
        }
    }
    if (engine != null) {
        try {
            engine.setInAmbientMode(inAmbientMode, animationDuration);
        } catch (RemoteException e) {
        }
    }
}