public static int getCombinedServiceState(ServiceState serviceState){
    if (serviceState == null) {
        return ServiceState.STATE_OUT_OF_SERVICE;
    }
    final int state = serviceState.getState();
    final int dataState = serviceState.getDataRegistrationState();
    if (state == ServiceState.STATE_OUT_OF_SERVICE || state == ServiceState.STATE_EMERGENCY_ONLY) {
        if (dataState == ServiceState.STATE_IN_SERVICE && isNotInIwlan(serviceState)) {
            return ServiceState.STATE_IN_SERVICE;
        }
    }
    return state;
}