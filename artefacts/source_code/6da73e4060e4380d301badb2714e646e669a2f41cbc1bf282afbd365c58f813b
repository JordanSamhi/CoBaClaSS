public static Rect getBoundsExcludingNavigationBarAndCutout(@NonNull WindowMetrics windowMetrics){
    final WindowInsets windowInsets = windowMetrics.getWindowInsets();
    Insets insets;
    if (ViewRootImpl.sNewInsetsMode == NEW_INSETS_MODE_FULL) {
        insets = windowInsets.getInsetsIgnoringVisibility(navigationBars() | displayCutout());
    } else {
        final Insets stableInsets = windowInsets.getStableInsets();
        insets = Insets.of(stableInsets.left, 0, stableInsets.right, stableInsets.bottom);
        final DisplayCutout cutout = windowInsets.getDisplayCutout();
        insets = (cutout != null) ? Insets.max(insets, Insets.of(cutout.getSafeInsets())) : insets;
    }
    final Rect result = new Rect(windowMetrics.getBounds());
    result.inset(insets);
    return result;
}