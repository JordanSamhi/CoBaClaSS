public void setSpeakerphoneOn(IBinder cb, boolean on){
    if (!checkAudioSettingsPermission("setSpeakerphoneOn()")) {
        return;
    }
    final int uid = Binder.getCallingUid();
    final int pid = Binder.getCallingPid();
    final String eventSource = new StringBuilder("setSpeakerphoneOn(").append(on).append(") from u/pid:").append(uid).append("/").append(pid).toString();
    final boolean stateChanged = mDeviceBroker.setSpeakerphoneOn(cb, pid, on, eventSource);
    new MediaMetrics.Item(MediaMetrics.Name.AUDIO_DEVICE + MediaMetrics.SEPARATOR + "setSpeakerphoneOn").setUid(uid).setPid(pid).set(MediaMetrics.Property.STATE, on ? MediaMetrics.Value.ON : MediaMetrics.Value.OFF).record();
    if (stateChanged) {
        final long ident = Binder.clearCallingIdentity();
        try {
            mContext.sendBroadcastAsUser(new Intent(AudioManager.ACTION_SPEAKERPHONE_STATE_CHANGED).setFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY), UserHandle.ALL);
        } finally {
            Binder.restoreCallingIdentity(ident);
        }
    }
}