public void addClient(IInputMethodClient client, IInputContext inputContext, int selfReportedDisplayId){
    final int callerUid = Binder.getCallingUid();
    final int callerPid = Binder.getCallingPid();
    synchronized (mMethodMap) {
        final int numClients = mClients.size();
        for (int i = 0; i < numClients; ++i) {
            final ClientState state = mClients.valueAt(i);
            if (state.uid == callerUid && state.pid == callerPid && state.selfReportedDisplayId == selfReportedDisplayId) {
                throw new SecurityException("uid=" + callerUid + "/pid=" + callerPid + "/displayId=" + selfReportedDisplayId + " is already registered.");
            }
        }
        final ClientDeathRecipient deathRecipient = new ClientDeathRecipient(this, client);
        try {
            client.asBinder().linkToDeath(deathRecipient, 0);
        } catch (RemoteException e) {
            throw new IllegalStateException(e);
        }
        mClients.put(client.asBinder(), new ClientState(client, inputContext, callerUid, callerPid, selfReportedDisplayId, deathRecipient));
    }
}