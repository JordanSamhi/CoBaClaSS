public void setBitmap(@Nullable Bitmap bitmap){
    if (isHardwareAccelerated()) {
        throw new RuntimeException("Can't set a bitmap device on a HW accelerated canvas");
    }
    Matrix preservedMatrix = null;
    if (bitmap != null && sCompatibilitySetBitmap) {
        preservedMatrix = getMatrix();
    }
    if (bitmap == null) {
        nSetBitmap(mNativeCanvasWrapper, 0);
        mDensity = Bitmap.DENSITY_NONE;
    } else {
        if (!bitmap.isMutable()) {
            throw new IllegalStateException();
        }
        throwIfCannotDraw(bitmap);
        nSetBitmap(mNativeCanvasWrapper, bitmap.getNativeInstance());
        mDensity = bitmap.mDensity;
    }
    if (preservedMatrix != null) {
        setMatrix(preservedMatrix);
    }
    mBitmap = bitmap;
}