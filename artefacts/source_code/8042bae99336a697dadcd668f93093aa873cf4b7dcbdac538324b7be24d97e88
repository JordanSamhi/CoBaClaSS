public List<MicrophoneInfo> getActiveMicrophones() throws IOException{
    ArrayList<MicrophoneInfo> activeMicrophones = new ArrayList<>();
    int status = native_get_active_microphones(activeMicrophones);
    if (status != AudioManager.SUCCESS) {
        if (status != AudioManager.ERROR_INVALID_OPERATION) {
            Log.e(TAG, "getActiveMicrophones failed:" + status);
        }
        Log.i(TAG, "getActiveMicrophones failed, fallback on routed device info");
    }
    AudioManager.setPortIdForMicrophones(activeMicrophones);
    if (activeMicrophones.size() == 0) {
        AudioDeviceInfo device = getRoutedDevice();
        if (device != null) {
            MicrophoneInfo microphone = AudioManager.microphoneInfoFromAudioDeviceInfo(device);
            ArrayList<Pair<Integer, Integer>> channelMapping = new ArrayList<>();
            for (int i = 0; i < mChannelCount; i++) {
                channelMapping.add(new Pair(i, MicrophoneInfo.CHANNEL_MAPPING_DIRECT));
            }
            microphone.setChannelMapping(channelMapping);
            activeMicrophones.add(microphone);
        }
    }
    return activeMicrophones;
}