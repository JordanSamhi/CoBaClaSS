public PlatformEncryptionKey getEncryptKey(int userId) throws KeyStoreException, UnrecoverableKeyException, NoSuchAlgorithmException, IOException, RemoteException{
    init(userId);
    try {
        getDecryptKeyInternal(userId);
        return getEncryptKeyInternal(userId);
    } catch (UnrecoverableKeyException e) {
        Log.i(TAG, String.format(Locale.US, "Regenerating permanently invalid Platform key for user %d.", userId));
        regenerate(userId);
        return getEncryptKeyInternal(userId);
    }
}