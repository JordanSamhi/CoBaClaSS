public void writeRules(String version, String ruleProvider, List<Rule> rules) throws IOException, RuleSerializeException{
    try {
        writeMetadata(mStagingDir, ruleProvider, version);
    } catch (IOException e) {
        Slog.e(TAG, "Error writing metadata.", e);
    }
    try (FileOutputStream ruleFileOutputStream = new FileOutputStream(new File(mStagingDir, RULES_FILE));
        FileOutputStream indexingFileOutputStream = new FileOutputStream(new File(mStagingDir, INDEXING_FILE))) {
        mRuleSerializer.serialize(rules, Optional.empty(), ruleFileOutputStream, indexingFileOutputStream);
    }
    switchStagingRulesDir();
    updateRuleIndexingController();
}