public void maybeSetNextAlarm(long now, long nextAlarm){
    if (mSchedule != null && mSchedule.exitAtAlarm) {
        if (nextAlarm == 0) {
            mSchedule.nextAlarm = 0;
        }
        if (nextAlarm > now) {
            if (mSchedule.nextAlarm == 0 || mSchedule.nextAlarm < now) {
                mSchedule.nextAlarm = nextAlarm;
            } else {
                mSchedule.nextAlarm = Math.min(mSchedule.nextAlarm, nextAlarm);
            }
        } else if (mSchedule.nextAlarm < now) {
            if (DEBUG) {
                Log.d(TAG, "All alarms are in the past " + mSchedule.nextAlarm);
            }
            mSchedule.nextAlarm = 0;
        }
    }
}