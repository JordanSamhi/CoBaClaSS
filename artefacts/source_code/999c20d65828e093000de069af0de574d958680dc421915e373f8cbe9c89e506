public int getConnectionOwnerUid(ConnectionInfo connectionInfo){
    final Vpn vpn = enforceActiveVpnOrNetworkStackPermission();
    if (vpn != null && vpn.getActiveAppVpnType() != VpnManager.TYPE_VPN_SERVICE) {
        throw new SecurityException("getConnectionOwnerUid() not allowed for non-VpnService VPNs");
    }
    if (connectionInfo.protocol != IPPROTO_TCP && connectionInfo.protocol != IPPROTO_UDP) {
        throw new IllegalArgumentException("Unsupported protocol " + connectionInfo.protocol);
    }
    final int uid = InetDiagMessage.getConnectionOwnerUid(connectionInfo.protocol, connectionInfo.local, connectionInfo.remote);
    if (vpn != null && !vpn.appliesToUid(uid)) {
        return INVALID_UID;
    }
    return uid;
}