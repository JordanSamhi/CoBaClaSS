public void setDeviceLockedForUser(int userId, boolean locked){
    enforceReportPermission();
    final long identity = Binder.clearCallingIdentity();
    try {
        if (mLockPatternUtils.isSeparateProfileChallengeEnabled(userId) && mLockPatternUtils.isSecure(userId)) {
            synchronized (mDeviceLockedForUser) {
                mDeviceLockedForUser.put(userId, locked);
            }
            KeyStore.getInstance().onUserLockedStateChanged(userId, locked);
            if (locked) {
                try {
                    ActivityManager.getService().notifyLockedProfile(userId);
                } catch (RemoteException e) {
                }
            }
            final Intent lockIntent = new Intent(Intent.ACTION_DEVICE_LOCKED_CHANGED);
            lockIntent.addFlags(Intent.FLAG_RECEIVER_REGISTERED_ONLY);
            lockIntent.putExtra(Intent.EXTRA_USER_HANDLE, userId);
            mContext.sendBroadcastAsUser(lockIntent, UserHandle.SYSTEM, Manifest.permission.TRUST_LISTENER, null);
        }
    } finally {
        Binder.restoreCallingIdentity(identity);
    }
}