public void prepare() throws IllegalStateException, IOException{
    if (mPath != null) {
        RandomAccessFile file = new RandomAccessFile(mPath, "rw");
        try {
            _setOutputFile(file.getFD());
        } finally {
            file.close();
        }
    } else if (mFd != null) {
        _setOutputFile(mFd);
    } else if (mFile != null) {
        RandomAccessFile file = new RandomAccessFile(mFile, "rw");
        try {
            _setOutputFile(file.getFD());
        } finally {
            file.close();
        }
    } else {
        throw new IOException("No valid output file");
    }
    _prepare();
}