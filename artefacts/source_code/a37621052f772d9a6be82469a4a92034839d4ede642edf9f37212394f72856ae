public void testRunTask_whenAgentUnavailable() throws Exception{
    TransportMock transportMock = setUpInitializedTransport(mTransport);
    setUpAgent(PACKAGE_1.unavailable());
    KeyValueBackupTask task = createKeyValueBackupTask(transportMock, PACKAGE_1);
    runTask(task);
    verify(mBackupManagerService).setWorkSource(null);
    verify(mObserver).onResult(PACKAGE_1.packageName, ERROR_AGENT_FAILURE);
    verify(mObserver).backupFinished(BackupManager.SUCCESS);
    assertBackupPendingFor(PACKAGE_1);
}