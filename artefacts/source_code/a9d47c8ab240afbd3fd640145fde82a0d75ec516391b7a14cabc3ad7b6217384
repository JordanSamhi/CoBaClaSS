public boolean checkCallersLocationPermission(String pkgName, @Nullable String featureId, int uid, boolean coarseForTargetSdkLessThanQ, @Nullable String message){
    boolean isTargetSdkLessThanQ = isTargetSdkLessThan(pkgName, Build.VERSION_CODES.Q, uid);
    String permissionType = Manifest.permission.ACCESS_FINE_LOCATION;
    if (coarseForTargetSdkLessThanQ && isTargetSdkLessThanQ) {
        permissionType = Manifest.permission.ACCESS_COARSE_LOCATION;
    }
    if (getUidPermission(permissionType, uid) == PackageManager.PERMISSION_DENIED) {
        return false;
    }
    boolean isFineLocationAllowed = noteAppOpAllowed(AppOpsManager.OPSTR_FINE_LOCATION, pkgName, featureId, uid, message);
    if (isFineLocationAllowed) {
        return true;
    }
    if (coarseForTargetSdkLessThanQ && isTargetSdkLessThanQ) {
        return noteAppOpAllowed(AppOpsManager.OPSTR_COARSE_LOCATION, pkgName, featureId, uid, message);
    }
    return false;
}