public boolean exchange(ByteBuffer req, ByteBuffer repl){
    if (repl == null) {
        return write(req);
    }
    boolean result = false;
    synchronized (mReplyBufLock) {
        mReplyBuf = repl;
        if (write(req)) {
            try {
                mReplyBufLock.wait();
                result = (mReplyBuf != null);
            } catch (InterruptedException ie) {
                result = false;
            }
        }
        mReplyBuf = null;
    }
    return result;
}