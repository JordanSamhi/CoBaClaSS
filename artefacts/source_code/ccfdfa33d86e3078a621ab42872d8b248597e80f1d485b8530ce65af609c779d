public void setConnection(@Nullable IWindowMagnificationConnection connection){
    synchronized (mLock) {
        if (mConnectionWrapper != null) {
            mConnectionWrapper.setConnectionCallback(null);
            if (mConnectionCallback != null) {
                mConnectionCallback.mExpiredDeathRecipient = true;
            }
            mConnectionWrapper.unlinkToDeath(mConnectionCallback);
            mConnectionWrapper = null;
        }
        if (connection != null) {
            mConnectionWrapper = new WindowMagnificationConnectionWrapper(connection);
        }
        if (mConnectionWrapper != null) {
            try {
                mConnectionCallback = new ConnectionCallback();
                mConnectionWrapper.linkToDeath(mConnectionCallback);
                mConnectionWrapper.setConnectionCallback(mConnectionCallback);
            } catch (RemoteException e) {
                Slog.e(TAG, "setConnection failed", e);
                mConnectionWrapper = null;
            }
        }
    }
}