public boolean serviceAdd(WifiP2pServiceInfo servInfo){
    synchronized (mLock) {
        if (!checkSupplicantP2pIfaceAndLogFailure("serviceAdd"))
            return false;
        if (servInfo == null) {
            Log.e(TAG, "Null service info passed.");
            return false;
        }
        for (String s : servInfo.getSupplicantQueryList()) {
            if (s == null) {
                Log.e(TAG, "Invalid service description (null).");
                return false;
            }
            String[] data = s.split(" ");
            if (data.length < 3) {
                Log.e(TAG, "Service specification invalid: " + s);
                return false;
            }
            SupplicantResult<Void> result = null;
            try {
                if ("upnp".equals(data[0])) {
                    int version = 0;
                    try {
                        version = Integer.parseInt(data[1], 16);
                    } catch (NumberFormatException e) {
                        Log.e(TAG, "UPnP Service specification invalid: " + s, e);
                        return false;
                    }
                    result = new SupplicantResult("addUpnpService(" + data[1] + ", " + data[2] + ")");
                    result.setResult(mISupplicantP2pIface.addUpnpService(version, data[2]));
                } else if ("bonjour".equals(data[0])) {
                    if (data[1] != null && data[2] != null) {
                        ArrayList<Byte> request = null;
                        ArrayList<Byte> response = null;
                        try {
                            request = NativeUtil.byteArrayToArrayList(NativeUtil.hexStringToByteArray(data[1]));
                            response = NativeUtil.byteArrayToArrayList(NativeUtil.hexStringToByteArray(data[2]));
                        } catch (Exception e) {
                            Log.e(TAG, "Invalid bonjour service description.");
                            return false;
                        }
                        result = new SupplicantResult("addBonjourService(" + data[1] + ", " + data[2] + ")");
                        result.setResult(mISupplicantP2pIface.addBonjourService(request, response));
                    }
                } else {
                    return false;
                }
            } catch (RemoteException e) {
                Log.e(TAG, "ISupplicantP2pIface exception: " + e);
                supplicantServiceDiedHandler();
            }
            if (result == null || !result.isSuccess())
                return false;
        }
        return true;
    }
}