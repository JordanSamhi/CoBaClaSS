public void setSelectedBubble(@Nullable BubbleViewProvider bubbleToSelect){
    if (DEBUG_BUBBLE_STACK_VIEW) {
        Log.d(TAG, "setSelectedBubble: " + bubbleToSelect);
    }
    if (mExpandedBubble == bubbleToSelect) {
        return;
    }
    if (bubbleToSelect == null || bubbleToSelect.getKey() != BubbleOverflow.KEY) {
        mBubbleData.setShowingOverflow(false);
    } else {
        mBubbleData.setShowingOverflow(true);
    }
    if (mIsExpanded && mIsExpansionAnimating) {
        cancelAllExpandCollapseSwitchAnimations();
    }
    if (mIsExpanded && mExpandedBubble != null && mExpandedBubble.getExpandedView() != null) {
        if (mExpandedBubble != null && mExpandedBubble.getExpandedView() != null) {
            mExpandedBubble.getExpandedView().setSurfaceZOrderedOnTop(true);
        }
        try {
            screenshotAnimatingOutBubbleIntoSurface((success) -> {
                mAnimatingOutSurfaceContainer.setVisibility(success ? View.VISIBLE : View.INVISIBLE);
                showNewlySelectedBubble(bubbleToSelect);
            });
        } catch (Exception e) {
            showNewlySelectedBubble(bubbleToSelect);
            e.printStackTrace();
        }
    } else {
        showNewlySelectedBubble(bubbleToSelect);
    }
}