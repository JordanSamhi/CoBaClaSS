public static Bitmap scaleDownIfNecessary(Bitmap bitmap, int maxWidth, int maxHeight){
    int bitmapWidth = bitmap.getWidth();
    int bitmapHeight = bitmap.getHeight();
    if (bitmapWidth > maxWidth || bitmapHeight > maxHeight) {
        float scale = Math.min((float) maxWidth / bitmapWidth, (float) maxHeight / bitmapHeight);
        bitmap = Bitmap.createScaledBitmap(bitmap, Math.max(1, (int) (scale * bitmapWidth)), Math.max(1, (int) (scale * bitmapHeight)), true);
    }
    return bitmap;
}