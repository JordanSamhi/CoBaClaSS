public boolean checkSystemAlertWindowPermission(int callingUid, String callingPackage){
    final int mode = mAppOps.noteOp(AppOpsManager.OPSTR_SYSTEM_ALERT_WINDOW, callingUid, callingPackage, null, null);
    if (mode == AppOpsManager.MODE_DEFAULT) {
        return mWifiPermissionsWrapper.getUidPermission(Manifest.permission.SYSTEM_ALERT_WINDOW, callingUid) == PackageManager.PERMISSION_GRANTED;
    }
    return mode == AppOpsManager.MODE_ALLOWED;
}