public static long[] parseRecurrenceDates(String recurrence) throws EventRecurrence.InvalidFormatException{
    String tz = Time.TIMEZONE_UTC;
    int tzidx = recurrence.indexOf(";");
    if (tzidx != -1) {
        tz = recurrence.substring(0, tzidx);
        recurrence = recurrence.substring(tzidx + 1);
    }
    Time time = new Time(tz);
    String[] rawDates = recurrence.split(",");
    int n = rawDates.length;
    long[] dates = new long[n];
    for (int i = 0; i < n; ++i) {
        try {
            time.parse(rawDates[i]);
        } catch (TimeFormatException e) {
            throw new EventRecurrence.InvalidFormatException("TimeFormatException thrown when parsing time " + rawDates[i] + " in recurrence " + recurrence);
        }
        dates[i] = time.toMillis(false);
        time.timezone = tz;
    }
    return dates;
}