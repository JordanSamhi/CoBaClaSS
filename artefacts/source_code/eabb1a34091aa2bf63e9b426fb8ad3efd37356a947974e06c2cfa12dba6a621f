public void writePhoneState(int phoneId, PhoneConstants.State phoneState){
    int state;
    switch(phoneState) {
        case IDLE:
            state = TelephonyCallSession.Event.PhoneState.STATE_IDLE;
            break;
        case RINGING:
            state = TelephonyCallSession.Event.PhoneState.STATE_RINGING;
            break;
        case OFFHOOK:
            state = TelephonyCallSession.Event.PhoneState.STATE_OFFHOOK;
            break;
        default:
            state = TelephonyCallSession.Event.PhoneState.STATE_UNKNOWN;
            break;
    }
    InProgressCallSession callSession = mInProgressCallSessions.get(phoneId);
    if (callSession == null) {
        Rlog.e(TAG, "writePhoneState: Call session is missing");
    } else {
        callSession.setLastKnownPhoneState(state);
        if ((state == TelephonyCallSession.Event.PhoneState.STATE_IDLE) && (!callSession.containsCsCalls())) {
            finishCallSession(callSession);
        }
        callSession.addEvent(new CallSessionEventBuilder(TelephonyCallSession.Event.Type.PHONE_STATE_CHANGED).setPhoneState(state));
    }
}