public int registerAndSelectTransport(ComponentName transportComponent){
    synchronized (mTransportLock) {
        try {
            selectTransport(getTransportName(transportComponent));
            return BackupManager.SUCCESS;
        } catch (TransportNotRegisteredException e) {
        }
    }
    int result = registerTransport(transportComponent);
    if (result != BackupManager.SUCCESS) {
        return result;
    }
    synchronized (mTransportLock) {
        try {
            selectTransport(getTransportName(transportComponent));
            return BackupManager.SUCCESS;
        } catch (TransportNotRegisteredException e) {
            Slog.wtf(TAG, "Transport got unregistered");
            return BackupManager.ERROR_TRANSPORT_UNAVAILABLE;
        }
    }
}