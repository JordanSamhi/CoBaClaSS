public int getCarrierNameDisplayBitmask(ServiceState ss){
    PersistableBundle config = getCarrierConfig();
    if (!TextUtils.isEmpty(getOperatorBrandOverride())) {
        return CARRIER_NAME_DISPLAY_BITMASK_SHOW_SPN;
    } else if (TextUtils.isEmpty(getServiceProviderName())) {
        return CARRIER_NAME_DISPLAY_BITMASK_SHOW_PLMN;
    } else {
        boolean useRoamingFromServiceState = config.getBoolean(CarrierConfigManager.KEY_SPN_DISPLAY_RULE_USE_ROAMING_FROM_SERVICE_STATE_BOOL);
        int carrierDisplayNameConditionFromSim = mIccRecords == null ? 0 : mIccRecords.getCarrierNameDisplayCondition();
        boolean isRoaming;
        if (useRoamingFromServiceState) {
            isRoaming = ss.getRoaming();
        } else {
            String[] hplmns = mIccRecords != null ? mIccRecords.getHomePlmns() : null;
            isRoaming = !ArrayUtils.contains(hplmns, ss.getOperatorNumeric());
        }
        int rule;
        if (isRoaming) {
            rule = CARRIER_NAME_DISPLAY_BITMASK_SHOW_PLMN;
            if ((carrierDisplayNameConditionFromSim & CARRIER_NAME_DISPLAY_CONDITION_BITMASK_SPN) == CARRIER_NAME_DISPLAY_CONDITION_BITMASK_SPN) {
                rule |= CARRIER_NAME_DISPLAY_BITMASK_SHOW_SPN;
            }
        } else {
            rule = CARRIER_NAME_DISPLAY_BITMASK_SHOW_SPN;
            if ((carrierDisplayNameConditionFromSim & CARRIER_NAME_DISPLAY_CONDITION_BITMASK_PLMN) == CARRIER_NAME_DISPLAY_CONDITION_BITMASK_PLMN) {
                rule |= CARRIER_NAME_DISPLAY_BITMASK_SHOW_PLMN;
            }
        }
        return rule;
    }
}