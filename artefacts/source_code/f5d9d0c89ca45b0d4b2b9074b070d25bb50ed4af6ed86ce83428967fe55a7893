public WifiBatteryStats getWifiBatteryStats(){
    final int which = STATS_SINCE_CHARGED;
    final long rawRealTime = SystemClock.elapsedRealtime() * 1000;
    final ControllerActivityCounter counter = getWifiControllerActivity();
    final long idleTimeMs = counter.getIdleTimeCounter().getCountLocked(which);
    final long scanTimeMs = counter.getScanTimeCounter().getCountLocked(which);
    final long rxTimeMs = counter.getRxTimeCounter().getCountLocked(which);
    final long txTimeMs = counter.getTxTimeCounters()[0].getCountLocked(which);
    final long totalControllerActivityTimeMs = computeBatteryRealtime(SystemClock.elapsedRealtime() * 1000, which) / 1000;
    final long sleepTimeMs = totalControllerActivityTimeMs - (idleTimeMs + rxTimeMs + txTimeMs);
    final long energyConsumedMaMs = counter.getPowerCounter().getCountLocked(which);
    final long monitoredRailChargeConsumedMaMs = counter.getMonitoredRailChargeConsumedMaMs().getCountLocked(which);
    long numAppScanRequest = 0;
    for (int i = 0; i < mUidStats.size(); i++) {
        numAppScanRequest += mUidStats.valueAt(i).mWifiScanTimer.getCountLocked(which);
    }
    long[] timeInStateMs = new long[NUM_WIFI_STATES];
    for (int i = 0; i < NUM_WIFI_STATES; i++) {
        timeInStateMs[i] = getWifiStateTime(i, rawRealTime, which) / 1000;
    }
    long[] timeInSupplStateMs = new long[NUM_WIFI_SUPPL_STATES];
    for (int i = 0; i < NUM_WIFI_SUPPL_STATES; i++) {
        timeInSupplStateMs[i] = getWifiSupplStateTime(i, rawRealTime, which) / 1000;
    }
    long[] timeSignalStrengthTimeMs = new long[NUM_WIFI_SIGNAL_STRENGTH_BINS];
    for (int i = 0; i < NUM_WIFI_SIGNAL_STRENGTH_BINS; i++) {
        timeSignalStrengthTimeMs[i] = getWifiSignalStrengthTime(i, rawRealTime, which) / 1000;
    }
    return new WifiBatteryStats(computeBatteryRealtime(rawRealTime, which) / 1000, getWifiActiveTime(rawRealTime, which) / 1000, getNetworkActivityPackets(NETWORK_WIFI_TX_DATA, which), getNetworkActivityBytes(NETWORK_WIFI_TX_DATA, which), getNetworkActivityPackets(NETWORK_WIFI_RX_DATA, which), getNetworkActivityBytes(NETWORK_WIFI_RX_DATA, which), sleepTimeMs, scanTimeMs, idleTimeMs, rxTimeMs, txTimeMs, energyConsumedMaMs, numAppScanRequest, timeInStateMs, timeSignalStrengthTimeMs, timeInSupplStateMs, monitoredRailChargeConsumedMaMs);
}