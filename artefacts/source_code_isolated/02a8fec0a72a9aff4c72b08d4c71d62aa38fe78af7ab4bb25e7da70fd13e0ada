public List<MicrophoneInfo> getMicrophones() throws IOException{
    ArrayList<MicrophoneInfo> microphones = new ArrayList<MicrophoneInfo>();
    int status = AudioSystem.getMicrophones(microphones);
    HashSet<Integer> filterTypes = new HashSet<>();
    filterTypes.add(AudioDeviceInfo.TYPE_TELEPHONY);
    if (status != AudioManager.SUCCESS) {
        if (status != AudioManager.ERROR_INVALID_OPERATION) {
            Log.e(TAG, "getMicrophones failed:" + status);
        }
        Log.i(TAG, "fallback on device info");
        addMicrophonesFromAudioDeviceInfo(microphones, filterTypes);
        return microphones;
    }
    setPortIdForMicrophones(microphones);
    filterTypes.add(AudioDeviceInfo.TYPE_BUILTIN_MIC);
    addMicrophonesFromAudioDeviceInfo(microphones, filterTypes);
    return microphones;
}