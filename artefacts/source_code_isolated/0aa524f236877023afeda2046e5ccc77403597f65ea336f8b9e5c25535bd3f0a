public char[] toCharArray(){
    synchronized (lock) {
        return Arrays.copyOf(buf, count);
    }
}