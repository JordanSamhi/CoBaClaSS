public void download(@NonNull DownloadRequest request){
    IMbmsDownloadService downloadService = mService.get();
    if (downloadService == null) {
        throw new IllegalStateException("Middleware not yet bound");
    }
    SharedPreferences prefs = mContext.getSharedPreferences(MbmsTempFileProvider.TEMP_FILE_ROOT_PREF_FILE_NAME, 0);
    if (prefs.getString(MbmsTempFileProvider.TEMP_FILE_ROOT_PREF_NAME, null) == null) {
        File tempRootDirectory = new File(mContext.getFilesDir(), DEFAULT_TOP_LEVEL_TEMP_DIRECTORY);
        tempRootDirectory.mkdirs();
        setTempFileRootDirectory(tempRootDirectory);
    }
    checkDownloadRequestDestination(request);
    try {
        int result = downloadService.download(request);
        if (result == MbmsErrors.SUCCESS) {
            writeDownloadRequestToken(request);
        } else {
            if (result == MbmsErrors.UNKNOWN) {
                close();
                throw new IllegalStateException("Middleware must not return an unknown" + " error code");
            }
            sendErrorToApp(result, null);
        }
    } catch (RemoteException e) {
        mService.set(null);
        sIsInitialized.set(false);
        sendErrorToApp(MbmsErrors.ERROR_MIDDLEWARE_LOST, null);
    }
}