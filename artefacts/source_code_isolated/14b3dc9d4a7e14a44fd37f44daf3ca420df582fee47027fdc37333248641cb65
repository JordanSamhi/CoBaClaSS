public static FileSystem newFileSystem(Path path, ClassLoader loader) throws IOException{
    if (path == null)
        throw new NullPointerException();
    Map<String, ?> env = Collections.emptyMap();
    for (FileSystemProvider provider : FileSystemProvider.installedProviders()) {
        try {
            return provider.newFileSystem(path, env);
        } catch (UnsupportedOperationException uoe) {
        }
    }
    if (loader != null) {
        ServiceLoader<FileSystemProvider> sl = ServiceLoader.load(FileSystemProvider.class, loader);
        for (FileSystemProvider provider : sl) {
            try {
                return provider.newFileSystem(path, env);
            } catch (UnsupportedOperationException uoe) {
            }
        }
    }
    throw new ProviderNotFoundException("Provider not found");
}