public final byte[] doFinal(byte[] input) throws IllegalStateException{
    chooseFirstProvider();
    if (initialized == false) {
        throw new IllegalStateException("MAC not initialized");
    }
    update(input);
    return doFinal();
}