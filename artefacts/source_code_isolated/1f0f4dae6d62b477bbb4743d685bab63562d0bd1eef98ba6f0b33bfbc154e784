public void onPrimaryMetadataOrStateChanged(MediaMetadata metadata, @PlaybackState.State int state){
    synchronized (this) {
        boolean nextVisible = NotificationMediaManager.isPlayingState(state);
        mMediaHandler.removeCallbacksAndMessages(null);
        if (mMediaIsVisible && !nextVisible && mStatusBarState != StatusBarState.SHADE) {
            mMediaWakeLock.setAcquired(true);
            mMediaHandler.postDelayed(() -> {
                synchronized (this) {
                    updateMediaStateLocked(metadata, state);
                    mMediaWakeLock.setAcquired(false);
                }
            }, 2000);
        } else {
            mMediaWakeLock.setAcquired(false);
            updateMediaStateLocked(metadata, state);
        }
    }
}