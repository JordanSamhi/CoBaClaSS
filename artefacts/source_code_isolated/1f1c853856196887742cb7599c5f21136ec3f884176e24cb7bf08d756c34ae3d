public void finish(WindowState win, boolean timeout){
    final Transaction t = win.getPendingTransaction();
    finish(t, win);
    if (win.mWinAnimator.mSurfaceController != null && !timeout) {
        t.deferTransactionUntil(win.mSurfaceControl, win.getClientViewRootSurface(), win.getFrameNumber());
        t.deferTransactionUntil(win.mWinAnimator.mSurfaceController.mSurfaceControl, win.getClientViewRootSurface(), win.getFrameNumber());
    }
}