public static byte[] encodeRules(@Nullable UiccAccessRule[] accessRules){
    if (accessRules == null) {
        return null;
    }
    try {
        ByteArrayOutputStream baos = new ByteArrayOutputStream();
        DataOutputStream output = new DataOutputStream(baos);
        output.writeInt(ENCODING_VERSION);
        output.writeInt(accessRules.length);
        for (UiccAccessRule accessRule : accessRules) {
            output.writeInt(accessRule.mCertificateHash.length);
            output.write(accessRule.mCertificateHash);
            if (accessRule.mPackageName != null) {
                output.writeBoolean(true);
                output.writeUTF(accessRule.mPackageName);
            } else {
                output.writeBoolean(false);
            }
            output.writeLong(accessRule.mAccessType);
        }
        output.close();
        return baos.toByteArray();
    } catch (IOException e) {
        throw new IllegalStateException("ByteArrayOutputStream should never lead to an IOException", e);
    }
}