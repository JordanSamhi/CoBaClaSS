public static LocationPermissionResult checkLocationPermission(Context context, LocationPermissionQuery query){
    if (query.callingUid == Process.PHONE_UID || query.callingUid == Process.SYSTEM_UID || query.callingUid == Process.NETWORK_STACK_UID || query.callingUid == Process.ROOT_UID) {
        return LocationPermissionResult.ALLOWED;
    }
    if (!checkSystemLocationAccess(context, query.callingUid, query.callingPid)) {
        return LocationPermissionResult.DENIED_SOFT;
    }
    if (query.minSdkVersionForFine < Integer.MAX_VALUE) {
        LocationPermissionResult resultForFine = checkAppLocationPermissionHelper(context, query, Manifest.permission.ACCESS_FINE_LOCATION);
        if (resultForFine != null) {
            return resultForFine;
        }
    }
    if (query.minSdkVersionForCoarse < Integer.MAX_VALUE) {
        LocationPermissionResult resultForCoarse = checkAppLocationPermissionHelper(context, query, Manifest.permission.ACCESS_COARSE_LOCATION);
        if (resultForCoarse != null) {
            return resultForCoarse;
        }
    }
    return LocationPermissionResult.ALLOWED;
}