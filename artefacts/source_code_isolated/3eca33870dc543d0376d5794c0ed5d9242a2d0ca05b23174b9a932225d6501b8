public void writeXml(XmlSerializer out, Integer version) throws IOException{
    out.startTag(null, ZEN_TAG);
    out.attribute(null, ZEN_ATT_VERSION, version == null ? Integer.toString(XML_VERSION) : Integer.toString(version));
    out.attribute(null, ZEN_ATT_USER, Integer.toString(user));
    out.startTag(null, ALLOW_TAG);
    out.attribute(null, ALLOW_ATT_CALLS, Boolean.toString(allowCalls));
    out.attribute(null, ALLOW_ATT_REPEAT_CALLERS, Boolean.toString(allowRepeatCallers));
    out.attribute(null, ALLOW_ATT_MESSAGES, Boolean.toString(allowMessages));
    out.attribute(null, ALLOW_ATT_REMINDERS, Boolean.toString(allowReminders));
    out.attribute(null, ALLOW_ATT_EVENTS, Boolean.toString(allowEvents));
    out.attribute(null, ALLOW_ATT_CALLS_FROM, Integer.toString(allowCallsFrom));
    out.attribute(null, ALLOW_ATT_MESSAGES_FROM, Integer.toString(allowMessagesFrom));
    out.attribute(null, ALLOW_ATT_ALARMS, Boolean.toString(allowAlarms));
    out.attribute(null, ALLOW_ATT_MEDIA, Boolean.toString(allowMedia));
    out.attribute(null, ALLOW_ATT_SYSTEM, Boolean.toString(allowSystem));
    out.attribute(null, ALLOW_ATT_CONV, Boolean.toString(allowConversations));
    out.attribute(null, ALLOW_ATT_CONV_FROM, Integer.toString(allowConversationsFrom));
    out.endTag(null, ALLOW_TAG);
    out.startTag(null, DISALLOW_TAG);
    out.attribute(null, DISALLOW_ATT_VISUAL_EFFECTS, Integer.toString(suppressedVisualEffects));
    out.endTag(null, DISALLOW_TAG);
    if (manualRule != null) {
        out.startTag(null, MANUAL_TAG);
        writeRuleXml(manualRule, out);
        out.endTag(null, MANUAL_TAG);
    }
    final int N = automaticRules.size();
    for (int i = 0; i < N; i++) {
        final String id = automaticRules.keyAt(i);
        final ZenRule automaticRule = automaticRules.valueAt(i);
        out.startTag(null, AUTOMATIC_TAG);
        out.attribute(null, RULE_ATT_ID, id);
        writeRuleXml(automaticRule, out);
        out.endTag(null, AUTOMATIC_TAG);
    }
    out.startTag(null, STATE_TAG);
    out.attribute(null, STATE_ATT_CHANNELS_BYPASSING_DND, Boolean.toString(areChannelsBypassingDnd));
    out.endTag(null, STATE_TAG);
    out.endTag(null, ZEN_TAG);
}