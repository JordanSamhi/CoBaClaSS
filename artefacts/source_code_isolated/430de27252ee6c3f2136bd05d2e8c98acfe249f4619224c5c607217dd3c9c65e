public void writeChunks(List<ChunkHash> allChunks, Map<ChunkHash, EncryptedChunk> newChunks) throws IOException{
    checkState(!mFinished, "Cannot write chunks after flushing.");
    List<ChunkHash> sortedChunks = new ArrayList<>(allChunks);
    Collections.sort(sortedChunks);
    for (ChunkHash chunkHash : sortedChunks) {
        if (!mChunkStartPositions.containsKey(chunkHash)) {
            mChunkStartPositions.put(chunkHash, mBackupWriter.getBytesWritten());
            writeChunkToFileAndListing(chunkHash, newChunks);
        }
    }
    long totalSizeKb = mBackupWriter.getBytesWritten() / BYTES_PER_KILOBYTE;
    long newChunksSizeKb = mNewChunksSizeBytes / BYTES_PER_KILOBYTE;
    Slog.d(TAG, "Total backup size: " + totalSizeKb + " kb, new chunks size: " + newChunksSizeKb + " kb");
    for (ChunkHash chunkHash : allChunks) {
        mKnownStarts.add(mChunkStartPositions.get(chunkHash).intValue());
    }
}