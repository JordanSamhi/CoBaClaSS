public boolean playWaveform(){
    Trace.traceBegin(Trace.TRACE_TAG_VIBRATOR, "playWaveform");
    try {
        synchronized (this) {
            final long[] timings = mWaveform.getTimings();
            final int[] amplitudes = mWaveform.getAmplitudes();
            final int len = timings.length;
            final int repeat = mWaveform.getRepeatIndex();
            int index = 0;
            long onDuration = 0;
            while (!mForceStop) {
                if (index < len) {
                    final int amplitude = amplitudes[index];
                    final long duration = timings[index++];
                    if (duration <= 0) {
                        continue;
                    }
                    if (amplitude != 0) {
                        if (onDuration <= 0) {
                            onDuration = getTotalOnDuration(timings, amplitudes, index - 1, repeat);
                            doVibratorOn(onDuration, amplitude, mUid, mAttrs);
                        } else {
                            doVibratorSetAmplitude(amplitude);
                        }
                    }
                    long waitTime = delayLocked(duration);
                    if (amplitude != 0) {
                        onDuration -= waitTime;
                    }
                } else if (repeat < 0) {
                    break;
                } else {
                    index = repeat;
                }
            }
            return !mForceStop;
        }
    } finally {
        Trace.traceEnd(Trace.TRACE_TAG_VIBRATOR);
    }
}