public void acknowledgeAdbBackupOrRestore(int token, boolean allow, String curPassword, String encPpassword, IFullBackupRestoreObserver observer){
    if (DEBUG) {
        Slog.d(TAG, addUserIdToLogMessage(mUserId, "acknowledgeAdbBackupOrRestore : token=" + token + " allow=" + allow));
    }
    mContext.enforceCallingPermission(android.Manifest.permission.BACKUP, "acknowledgeAdbBackupOrRestore");
    long oldId = Binder.clearCallingIdentity();
    try {
        AdbParams params;
        synchronized (mAdbBackupRestoreConfirmations) {
            params = mAdbBackupRestoreConfirmations.get(token);
            if (params != null) {
                mBackupHandler.removeMessages(MSG_FULL_CONFIRMATION_TIMEOUT, params);
                mAdbBackupRestoreConfirmations.delete(token);
                if (allow) {
                    final int verb = params instanceof AdbBackupParams ? MSG_RUN_ADB_BACKUP : MSG_RUN_ADB_RESTORE;
                    params.observer = observer;
                    params.curPassword = curPassword;
                    params.encryptPassword = encPpassword;
                    if (MORE_DEBUG) {
                        Slog.d(TAG, addUserIdToLogMessage(mUserId, "Sending conf message with verb " + verb));
                    }
                    mWakelock.acquire();
                    Message msg = mBackupHandler.obtainMessage(verb, params);
                    mBackupHandler.sendMessage(msg);
                } else {
                    Slog.w(TAG, addUserIdToLogMessage(mUserId, "User rejected full backup/restore operation"));
                    signalAdbBackupRestoreCompletion(params);
                }
            } else {
                Slog.w(TAG, addUserIdToLogMessage(mUserId, "Attempted to ack full backup/restore with invalid token"));
            }
        }
    } finally {
        Binder.restoreCallingIdentity(oldId);
    }
}