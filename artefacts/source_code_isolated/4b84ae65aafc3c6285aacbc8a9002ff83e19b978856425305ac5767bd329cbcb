public int getApiCallCount(boolean unlimited){
    final ShortcutService s = mShortcutUser.mService;
    if (s.isUidForegroundLocked(mPackageUid) || (mLastKnownForegroundElapsedTime < s.getUidLastForegroundElapsedTimeLocked(mPackageUid)) || unlimited) {
        mLastKnownForegroundElapsedTime = s.injectElapsedRealtime();
        resetRateLimiting();
    }
    final long last = s.getLastResetTimeLocked();
    final long now = s.injectCurrentTimeMillis();
    if (ShortcutService.isClockValid(now) && mLastResetTime > now) {
        Slog.w(TAG, "Clock rewound");
        mLastResetTime = now;
        mApiCallCount = 0;
        return mApiCallCount;
    }
    if (mLastResetTime < last) {
        if (ShortcutService.DEBUG) {
            Slog.d(TAG, String.format("%s: last reset=%d, now=%d, last=%d: resetting", getPackageName(), mLastResetTime, now, last));
        }
        mApiCallCount = 0;
        mLastResetTime = last;
    }
    return mApiCallCount;
}