public static List<PackageInfo> getStorableApplications(PackageManager pm, int userId){
    List<PackageInfo> pkgs = pm.getInstalledPackagesAsUser(PackageManager.GET_SIGNING_CERTIFICATES, userId);
    int N = pkgs.size();
    for (int a = N - 1; a >= 0; a--) {
        PackageInfo pkg = pkgs.get(a);
        if (!AppBackupUtils.appIsEligibleForBackup(pkg.applicationInfo, userId)) {
            pkgs.remove(a);
        }
    }
    return pkgs;
}