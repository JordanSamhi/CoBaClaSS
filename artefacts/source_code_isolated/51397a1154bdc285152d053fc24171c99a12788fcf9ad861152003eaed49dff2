public static StorageVolume[] getVolumeList(int userId, int flags){
    final IStorageManager storageManager = IStorageManager.Stub.asInterface(ServiceManager.getService("mount"));
    try {
        String packageName = ActivityThread.currentOpPackageName();
        if (packageName == null) {
            String[] packageNames = ActivityThread.getPackageManager().getPackagesForUid(android.os.Process.myUid());
            if (packageNames == null || packageNames.length <= 0) {
                Log.w(TAG, "Missing package names; no storage volumes available");
                return new StorageVolume[0];
            }
            packageName = packageNames[0];
        }
        final int uid = ActivityThread.getPackageManager().getPackageUid(packageName, PackageManager.MATCH_DEBUG_TRIAGED_MISSING, userId);
        if (uid <= 0) {
            Log.w(TAG, "Missing UID; no storage volumes available");
            return new StorageVolume[0];
        }
        return storageManager.getVolumeList(uid, packageName, flags);
    } catch (RemoteException e) {
        throw e.rethrowFromSystemServer();
    }
}