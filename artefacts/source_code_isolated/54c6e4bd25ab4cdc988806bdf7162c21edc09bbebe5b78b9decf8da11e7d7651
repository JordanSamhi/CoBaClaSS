public void updateResourcesForActivity(@NonNull IBinder activityToken, @Nullable Configuration overrideConfig, int displayId, boolean movedToDifferentDisplay){
    try {
        Trace.traceBegin(Trace.TRACE_TAG_RESOURCES, "ResourcesManager#updateResourcesForActivity");
        synchronized (this) {
            final ActivityResources activityResources = getOrCreateActivityResourcesStructLocked(activityToken);
            if (Objects.equals(activityResources.overrideConfig, overrideConfig) && !movedToDifferentDisplay) {
                return;
            }
            final Configuration oldConfig = new Configuration(activityResources.overrideConfig);
            if (overrideConfig != null) {
                activityResources.overrideConfig.setTo(overrideConfig);
            } else {
                activityResources.overrideConfig.unset();
            }
            if (DEBUG) {
                Throwable here = new Throwable();
                here.fillInStackTrace();
                Slog.d(TAG, "updating resources override for activity=" + activityToken + " from oldConfig=" + Configuration.resourceQualifierString(oldConfig) + " to newConfig=" + Configuration.resourceQualifierString(activityResources.overrideConfig) + " displayId=" + displayId, here);
            }
            final int refCount = activityResources.activityResources.size();
            for (int i = 0; i < refCount; i++) {
                final WeakReference<Resources> weakResRef = activityResources.activityResources.get(i);
                final Resources resources = weakResRef.get();
                if (resources == null) {
                    continue;
                }
                final ResourcesKey newKey = rebaseActivityOverrideConfig(resources, oldConfig, overrideConfig, displayId);
                if (newKey != null) {
                    updateActivityResources(resources, newKey, false);
                }
            }
        }
    } finally {
        Trace.traceEnd(Trace.TRACE_TAG_RESOURCES);
    }
}