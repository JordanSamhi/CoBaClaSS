public void writeTo(Writer out) throws IOException{
    synchronized (lock) {
        out.write(buf, 0, count);
    }
}