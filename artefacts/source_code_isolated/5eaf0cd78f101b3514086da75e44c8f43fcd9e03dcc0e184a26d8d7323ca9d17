public static List<UserPackage> getPackageInfosAllUsers(Context context, String packageName, int packageFlags){
    List<UserInfo> users = getAllUsers(context);
    List<UserPackage> userPackages = new ArrayList<UserPackage>(users.size());
    for (UserInfo user : users) {
        PackageInfo packageInfo = null;
        try {
            packageInfo = context.getPackageManager().getPackageInfoAsUser(packageName, packageFlags, user.id);
        } catch (NameNotFoundException e) {
        }
        userPackages.add(new UserPackage(user, packageInfo));
    }
    return userPackages;
}