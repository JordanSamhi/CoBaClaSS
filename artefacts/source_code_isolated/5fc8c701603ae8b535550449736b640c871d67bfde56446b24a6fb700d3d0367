public String legacyPasswordToHash(byte[] password, int userId){
    if (password == null || password.length == 0) {
        return null;
    }
    try {
        byte[] salt = getSalt(userId).getBytes();
        byte[] saltedPassword = Arrays.copyOf(password, password.length + salt.length);
        System.arraycopy(salt, 0, saltedPassword, password.length, salt.length);
        byte[] sha1 = MessageDigest.getInstance("SHA-1").digest(saltedPassword);
        byte[] md5 = MessageDigest.getInstance("MD5").digest(saltedPassword);
        byte[] combined = new byte[sha1.length + md5.length];
        System.arraycopy(sha1, 0, combined, 0, sha1.length);
        System.arraycopy(md5, 0, combined, sha1.length, md5.length);
        final char[] hexEncoded = HexEncoding.encode(combined);
        Arrays.fill(saltedPassword, (byte) 0);
        return new String(hexEncoded);
    } catch (NoSuchAlgorithmException e) {
        throw new AssertionError("Missing digest algorithm: ", e);
    }
}