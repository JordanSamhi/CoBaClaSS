public void setHttpProxy(ProxyInfo httpProxy){
    if (httpProxy == null) {
        mIpConfiguration.setProxySettings(IpConfiguration.ProxySettings.NONE);
        mIpConfiguration.setHttpProxy(null);
        return;
    }
    ProxyInfo httpProxyCopy;
    ProxySettings proxySettingCopy;
    if (!Uri.EMPTY.equals(httpProxy.getPacFileUrl())) {
        proxySettingCopy = IpConfiguration.ProxySettings.PAC;
        httpProxyCopy = ProxyInfo.buildPacProxy(httpProxy.getPacFileUrl(), httpProxy.getPort());
    } else {
        proxySettingCopy = IpConfiguration.ProxySettings.STATIC;
        httpProxyCopy = ProxyInfo.buildDirectProxy(httpProxy.getHost(), httpProxy.getPort(), Arrays.asList(httpProxy.getExclusionList()));
    }
    if (!httpProxyCopy.isValid()) {
        throw new IllegalArgumentException("Invalid ProxyInfo: " + httpProxyCopy.toString());
    }
    mIpConfiguration.setProxySettings(proxySettingCopy);
    mIpConfiguration.setHttpProxy(httpProxyCopy);
}