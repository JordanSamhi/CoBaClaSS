public void consume(ByteBuffer buffer) throws DigestException{
    int offset = buffer.position();
    int remaining = buffer.remaining();
    while (remaining > 0) {
        int allowance = (int) Math.min(remaining, BUFFER_SIZE - mBytesDigestedSinceReset);
        buffer.limit(buffer.position() + allowance);
        mMd.update(buffer);
        offset += allowance;
        remaining -= allowance;
        mBytesDigestedSinceReset += allowance;
        if (mBytesDigestedSinceReset == BUFFER_SIZE) {
            mMd.digest(mDigestBuffer, 0, mDigestBuffer.length);
            mOutput.put(mDigestBuffer);
            if (mSalt != null) {
                mMd.update(mSalt);
            }
            mBytesDigestedSinceReset = 0;
        }
    }
}