public void run() throws Exception{
    StatusReporter reporter = null;
    float[] oldAnims = null;
    try {
        if (protoFile || protoStd) {
            reporter = new ProtoStatusReporter();
        } else if (wait) {
            reporter = new TextStatusReporter(rawMode);
        }
        InstrumentationWatcher watcher = null;
        UiAutomationConnection connection = null;
        if (reporter != null) {
            watcher = new InstrumentationWatcher(reporter);
            connection = new UiAutomationConnection();
        }
        if (noWindowAnimation) {
            oldAnims = mWm.getAnimationScales();
            mWm.setAnimationScale(0, 0.0f);
            mWm.setAnimationScale(1, 0.0f);
            mWm.setAnimationScale(2, 0.0f);
        }
        final ComponentName cn = parseComponentName(componentNameArg);
        if (abi != null) {
            final String[] supportedAbis = Build.SUPPORTED_ABIS;
            boolean matched = false;
            for (String supportedAbi : supportedAbis) {
                if (supportedAbi.equals(abi)) {
                    matched = true;
                    break;
                }
            }
            if (!matched) {
                throw new AndroidException("INSTRUMENTATION_FAILED: Unsupported instruction set " + abi);
            }
        }
        int flags = 0;
        if (disableHiddenApiChecks) {
            flags |= INSTR_FLAG_DISABLE_HIDDEN_API_CHECKS;
        }
        if (disableTestApiChecks) {
            flags |= INSTR_FLAG_DISABLE_TEST_API_CHECKS;
        }
        if (disableIsolatedStorage) {
            flags |= INSTR_FLAG_DISABLE_ISOLATED_STORAGE;
        }
        if (!mAm.startInstrumentation(cn, profileFile, flags, args, watcher, connection, userId, abi)) {
            throw new AndroidException("INSTRUMENTATION_FAILED: " + cn.flattenToString());
        }
        if (watcher != null) {
            if (!watcher.waitForFinish()) {
                reporter.onError("INSTRUMENTATION_ABORTED: System has crashed.", false);
                return;
            }
        }
    } catch (Exception ex) {
        if (reporter != null) {
            reporter.onError(ex.getMessage(), true);
        }
        throw ex;
    } finally {
        if (oldAnims != null) {
            mWm.setAnimationScales(oldAnims);
        }
    }
}