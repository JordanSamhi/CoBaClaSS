public boolean onVrModeChanged(ActivityRecord record){
    VrManagerInternal vrService = LocalServices.getService(VrManagerInternal.class);
    if (vrService == null) {
        return false;
    }
    boolean vrMode;
    ComponentName requestedPackage;
    ComponentName callingPackage;
    int userId;
    int processId = -1;
    boolean changed = false;
    synchronized (mGlobalAmLock) {
        vrMode = record.requestedVrComponent != null;
        requestedPackage = record.requestedVrComponent;
        userId = record.mUserId;
        callingPackage = record.info.getComponentName();
        changed = changeVrModeLocked(vrMode, record.app);
        if (record.app != null) {
            processId = record.app.getPid();
        }
    }
    vrService.setVrMode(vrMode, requestedPackage, userId, processId, callingPackage);
    return changed;
}