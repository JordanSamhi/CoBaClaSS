public static void routeSocketDataToOutput(ParcelFileDescriptor inPipe, OutputStream out) throws IOException{
    FileInputStream raw = new FileInputStream(inPipe.getFileDescriptor());
    DataInputStream in = new DataInputStream(raw);
    byte[] buffer = new byte[32 * 1024];
    int chunkTotal;
    while ((chunkTotal = in.readInt()) > 0) {
        while (chunkTotal > 0) {
            int toRead = (chunkTotal > buffer.length) ? buffer.length : chunkTotal;
            int nRead = in.read(buffer, 0, toRead);
            if (nRead < 0) {
                Slog.e(TAG, "Unexpectedly reached end of file while reading data");
                throw new EOFException();
            }
            out.write(buffer, 0, nRead);
            chunkTotal -= nRead;
        }
    }
}