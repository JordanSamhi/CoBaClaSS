public WifiP2pStats consolidateProto(){
    synchronized (mLock) {
        mWifiP2pStatsProto.numPersistentGroup = mNumPersistentGroup;
        int connectionEventCount = mConnectionEventList.size();
        if (mCurrentConnectionEvent != null) {
            connectionEventCount--;
        }
        mWifiP2pStatsProto.connectionEvent = new P2pConnectionEvent[connectionEventCount];
        for (int i = 0; i < connectionEventCount; i++) {
            mWifiP2pStatsProto.connectionEvent[i] = mConnectionEventList.get(i);
        }
        int groupEventCount = mGroupEventList.size();
        if (mCurrentGroupEvent != null) {
            groupEventCount--;
        }
        mWifiP2pStatsProto.groupEvent = new GroupEvent[groupEventCount];
        for (int i = 0; i < groupEventCount; i++) {
            mWifiP2pStatsProto.groupEvent[i] = mGroupEventList.get(i);
        }
        return mWifiP2pStatsProto;
    }
}