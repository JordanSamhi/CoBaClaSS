public void onBeforeStartUser(@UserIdInt int userId){
    UserInfo userInfo = getUserInfo(userId);
    if (userInfo == null) {
        return;
    }
    TimingsTraceAndSlog t = new TimingsTraceAndSlog();
    t.traceBegin("onBeforeStartUser-" + userId);
    final int userSerial = userInfo.serialNumber;
    boolean migrateAppsData = !Build.FINGERPRINT.equals(userInfo.lastLoggedInFingerprint);
    t.traceBegin("prepareUserData");
    mUserDataPreparer.prepareUserData(userId, userSerial, StorageManager.FLAG_STORAGE_DE);
    t.traceEnd();
    t.traceBegin("reconcileAppsData");
    mPm.reconcileAppsData(userId, StorageManager.FLAG_STORAGE_DE, migrateAppsData);
    t.traceEnd();
    if (userId != UserHandle.USER_SYSTEM) {
        t.traceBegin("applyUserRestrictions");
        synchronized (mRestrictionsLock) {
            applyUserRestrictionsLR(userId);
        }
        t.traceEnd();
    }
    t.traceEnd();
}