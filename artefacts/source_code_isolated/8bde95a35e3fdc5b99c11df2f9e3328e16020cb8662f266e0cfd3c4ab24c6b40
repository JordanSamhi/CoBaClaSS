public static X509Certificate[] parseCertificateChain(final KeymasterCertificateChain kmChain) throws KeyAttestationException{
    final Collection<byte[]> rawChain = kmChain.getCertificates();
    if (rawChain.size() < 2) {
        throw new KeyAttestationException("Attestation certificate chain contained " + rawChain.size() + " entries. At least two are required.");
    }
    final ByteArrayOutputStream concatenatedRawChain = new ByteArrayOutputStream();
    try {
        for (final byte[] cert : rawChain) {
            concatenatedRawChain.write(cert);
        }
        return CertificateFactory.getInstance("X.509").generateCertificates(new ByteArrayInputStream(concatenatedRawChain.toByteArray())).toArray(new X509Certificate[0]);
    } catch (Exception e) {
        throw new KeyAttestationException("Unable to construct certificate chain", e);
    }
}