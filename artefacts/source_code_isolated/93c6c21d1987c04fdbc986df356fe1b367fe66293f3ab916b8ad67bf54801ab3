public Bitmap createSnapshot(ViewDebug.CanvasProvider canvasProvider, boolean skipChildren){
    int width = mRight - mLeft;
    int height = mBottom - mTop;
    final AttachInfo attachInfo = mAttachInfo;
    final float scale = attachInfo != null ? attachInfo.mApplicationScale : 1.0f;
    width = (int) ((width * scale) + 0.5f);
    height = (int) ((height * scale) + 0.5f);
    Canvas oldCanvas = null;
    try {
        Canvas canvas = canvasProvider.getCanvas(this, width > 0 ? width : 1, height > 0 ? height : 1);
        if (attachInfo != null) {
            oldCanvas = attachInfo.mCanvas;
            attachInfo.mCanvas = null;
        }
        computeScroll();
        final int restoreCount = canvas.save();
        canvas.scale(scale, scale);
        canvas.translate(-mScrollX, -mScrollY);
        int flags = mPrivateFlags;
        mPrivateFlags &= ~PFLAG_DIRTY_MASK;
        if ((mPrivateFlags & PFLAG_SKIP_DRAW) == PFLAG_SKIP_DRAW) {
            dispatchDraw(canvas);
            drawAutofilledHighlight(canvas);
            if (mOverlay != null && !mOverlay.isEmpty()) {
                mOverlay.getOverlayView().draw(canvas);
            }
        } else {
            draw(canvas);
        }
        mPrivateFlags = flags;
        canvas.restoreToCount(restoreCount);
        return canvasProvider.createBitmap();
    } finally {
        if (oldCanvas != null) {
            attachInfo.mCanvas = oldCanvas;
        }
    }
}