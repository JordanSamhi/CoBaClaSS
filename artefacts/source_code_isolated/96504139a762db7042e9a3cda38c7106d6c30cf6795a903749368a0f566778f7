public void writeOnImsCallTerminated(int phoneId, ImsCallSession session, ImsReasonInfo reasonInfo, CallQualityMetrics cqm, EmergencyNumber emergencyNumber, String countryIso, int emergencyNumberDatabaseVersion){
    InProgressCallSession callSession = mInProgressCallSessions.get(phoneId);
    if (callSession == null) {
        Rlog.e(TAG, "Call session is missing");
    } else {
        CallSessionEventBuilder callSessionEvent = new CallSessionEventBuilder(TelephonyCallSession.Event.Type.IMS_CALL_TERMINATED);
        callSessionEvent.setCallIndex(getCallId(session));
        callSessionEvent.setImsReasonInfo(toImsReasonInfoProto(reasonInfo));
        if (cqm != null) {
            callSessionEvent.setCallQualitySummaryDl(cqm.getCallQualitySummaryDl()).setCallQualitySummaryUl(cqm.getCallQualitySummaryUl());
        }
        if (emergencyNumber != null) {
            if (ThreadLocalRandom.current().nextDouble(0, 100) < getSamplePercentageForEmergencyCall(countryIso)) {
                callSessionEvent.setIsImsEmergencyCall(true);
                callSessionEvent.setImsEmergencyNumberInfo(convertEmergencyNumberToEmergencyNumberInfo(emergencyNumber));
                callSessionEvent.setEmergencyNumberDatabaseVersion(emergencyNumberDatabaseVersion);
            }
        }
        callSession.addEvent(callSessionEvent);
    }
}