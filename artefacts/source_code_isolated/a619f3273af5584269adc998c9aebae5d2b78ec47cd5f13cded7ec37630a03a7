public static long multiplySafe(long value, long num, long den){
    if (den == 0)
        den = 1;
    long x = value;
    long y = num;
    long r = x * y;
    long ax = Math.abs(x);
    long ay = Math.abs(y);
    if (((ax | ay) >>> 31 != 0)) {
        if (((y != 0) && (r / y != x)) || (x == Long.MIN_VALUE && y == -1)) {
            return (long) (((double) num / den) * value);
        }
    }
    return r / den;
}