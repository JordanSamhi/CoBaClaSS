public boolean onKeyPreIme(int keyCode, KeyEvent event){
    final boolean consume = super.onKeyPreIme(keyCode, event);
    if (consume && keyCode == KeyEvent.KEYCODE_BACK && event.getAction() == KeyEvent.ACTION_UP) {
        setImeVisibility(false);
    }
    return consume;
}