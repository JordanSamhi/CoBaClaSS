public void onReceive(@Nullable Context context, @Nullable Intent intent){
    String action = intent.getAction();
    if (Intent.ACTION_PACKAGE_ADDED.equals(action)) {
        String pkg = getPackageName(intent);
        if (pkg != null) {
            if (intent.getBooleanExtra(Intent.EXTRA_REPLACING, false)) {
                onPackageUpdateFinished(pkg);
                onPackageModified(pkg);
            } else {
                onPackageAdded(pkg);
            }
            onPackageAppeared();
        }
    } else if (Intent.ACTION_PACKAGE_REMOVED.equals(action)) {
        String pkg = getPackageName(intent);
        if (pkg != null) {
            if (!intent.getBooleanExtra(Intent.EXTRA_REPLACING, false)) {
                onPackageRemoved(pkg);
            }
            onPackageDisappeared();
        }
    } else if (Intent.ACTION_PACKAGE_CHANGED.equals(action)) {
        String pkg = getPackageName(intent);
        if (pkg != null) {
            onPackageModified(pkg);
        }
    } else if (Intent.ACTION_QUERY_PACKAGE_RESTART.equals(action)) {
        String[] disappearingPackages = intent.getStringArrayExtra(Intent.EXTRA_PACKAGES);
        onHandleForceStop(disappearingPackages, false);
    } else if (Intent.ACTION_PACKAGE_RESTARTED.equals(action)) {
        String[] disappearingPackages = new String[] { getPackageName(intent) };
        onHandleForceStop(disappearingPackages, true);
    }
}