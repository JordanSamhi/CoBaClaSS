public UpstreamNetworkState selectPreferredUpstreamType(Iterable<Integer> preferredTypes){
    final TypeStatePair typeStatePair = findFirstAvailableUpstreamByType(mNetworkMap.values(), preferredTypes, isCellularUpstreamPermitted());
    mLog.log("preferred upstream type: " + typeStatePair.type);
    switch(typeStatePair.type) {
        case TYPE_MOBILE_DUN:
        case TYPE_MOBILE_HIPRI:
            if (!mIsDefaultCellularUpstream) {
                mEntitlementMgr.maybeRunProvisioning();
            }
            registerMobileNetworkRequest();
            break;
        case TYPE_NONE:
            if (!isCellularUpstreamPermitted())
                releaseMobileNetworkRequest();
            break;
        default:
            releaseMobileNetworkRequest();
            break;
    }
    return typeStatePair.ns;
}