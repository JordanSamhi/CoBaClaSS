public static MessageDigest getInstance(String algorithm, String provider) throws NoSuchAlgorithmException, NoSuchProviderException{
    if (provider == null || provider.length() == 0)
        throw new IllegalArgumentException("missing provider");
    Providers.checkBouncyCastleDeprecation(provider, "MessageDigest", algorithm);
    Object[] objs = Security.getImpl(algorithm, "MessageDigest", provider);
    if (objs[0] instanceof MessageDigest) {
        MessageDigest md = (MessageDigest) objs[0];
        md.provider = (Provider) objs[1];
        return md;
    } else {
        MessageDigest delegate = new Delegate((MessageDigestSpi) objs[0], algorithm);
        delegate.provider = (Provider) objs[1];
        return delegate;
    }
}