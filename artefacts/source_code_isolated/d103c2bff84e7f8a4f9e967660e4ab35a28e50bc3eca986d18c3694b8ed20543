public boolean isUserUnlocked(@UserIdInt int userId){
    int state;
    synchronized (mUserStates) {
        state = mUserStates.get(userId, -1);
    }
    if (state == UserState.STATE_STOPPING || state == UserState.STATE_SHUTDOWN) {
        return StorageManager.isUserKeyUnlocked(userId);
    }
    return state == UserState.STATE_RUNNING_UNLOCKED;
}