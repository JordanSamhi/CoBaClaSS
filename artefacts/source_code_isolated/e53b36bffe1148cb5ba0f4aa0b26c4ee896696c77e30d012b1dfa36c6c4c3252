public int requestPriority(int pid, int tid, int prio, boolean isForApp){
    if (!isPermitted() || prio < PRIORITY_MIN || prio > PRIORITY_MAX || Process.getThreadGroupLeader(tid) != pid) {
        return PackageManager.PERMISSION_DENIED;
    }
    if (Binder.getCallingUid() != Process.BLUETOOTH_UID) {
        try {
            Process.setThreadGroup(tid, !isForApp ? Process.THREAD_GROUP_AUDIO_SYS : Process.THREAD_GROUP_RT_APP);
        } catch (RuntimeException e) {
            Log.e(TAG, "Failed setThreadGroup: " + e);
            return PackageManager.PERMISSION_DENIED;
        }
    }
    try {
        Process.setThreadScheduler(tid, Process.SCHED_FIFO | Process.SCHED_RESET_ON_FORK, prio);
    } catch (RuntimeException e) {
        Log.e(TAG, "Failed setThreadScheduler: " + e);
        return PackageManager.PERMISSION_DENIED;
    }
    return PackageManager.PERMISSION_GRANTED;
}