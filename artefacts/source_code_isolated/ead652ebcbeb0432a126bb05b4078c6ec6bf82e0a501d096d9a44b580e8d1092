public void flush() throws IOException{
    synchronized (lock) {
        flushBuffer();
        out.flush();
    }
}