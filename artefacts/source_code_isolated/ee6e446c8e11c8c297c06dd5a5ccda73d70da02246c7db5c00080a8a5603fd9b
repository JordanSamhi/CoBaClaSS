public static boolean setDefaultDialerApplication(Context context, String packageName, int user){
    long identity = Binder.clearCallingIdentity();
    try {
        CompletableFuture<Void> future = new CompletableFuture<>();
        Consumer<Boolean> callback = successful -> {
            if (successful) {
                future.complete(null);
            } else {
                future.completeExceptionally(new RuntimeException());
            }
        };
        context.getSystemService(RoleManager.class).addRoleHolderAsUser(RoleManager.ROLE_DIALER, packageName, 0, UserHandle.of(user), AsyncTask.THREAD_POOL_EXECUTOR, callback);
        future.get(5, TimeUnit.SECONDS);
        return true;
    } catch (InterruptedException | ExecutionException | TimeoutException e) {
        Slog.e(TAG, "Failed to set default dialer to " + packageName + " for user " + user, e);
        return false;
    } finally {
        Binder.restoreCallingIdentity(identity);
    }
}