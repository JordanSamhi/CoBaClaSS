public static Map<Thread, StackTraceElement[]> getAllStackTraces(){
    int count = ThreadGroup.systemThreadGroup.activeCount();
    Thread[] threads = new Thread[count + count / 2];
    count = ThreadGroup.systemThreadGroup.enumerate(threads);
    Map<Thread, StackTraceElement[]> m = new HashMap<Thread, StackTraceElement[]>();
    for (int i = 0; i < count; i++) {
        StackTraceElement[] stackTrace = threads[i].getStackTrace();
        m.put(threads[i], stackTrace);
    }
    return m;
}