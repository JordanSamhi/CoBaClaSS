public void flush() throws IOException{
    if (syncFlush && !def.finished()) {
        int len = 0;
        while ((len = def.deflate(buf, 0, buf.length, Deflater.SYNC_FLUSH)) > 0) {
            out.write(buf, 0, len);
            if (len < buf.length)
                break;
        }
    }
    out.flush();
}