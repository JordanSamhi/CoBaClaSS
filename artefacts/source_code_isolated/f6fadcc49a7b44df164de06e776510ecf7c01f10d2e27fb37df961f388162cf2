public synchronized void writeNewCBSms(int phoneId, int format, int priority, boolean isCMAS, boolean isETWS, int serviceCategory, int serialNumber, long deliveredTimestamp){
    InProgressSmsSession smsSession = startNewSmsSessionIfNeeded(phoneId);
    int type;
    if (isCMAS) {
        type = SmsSession.Event.CBMessageType.CMAS;
    } else if (isETWS) {
        type = SmsSession.Event.CBMessageType.ETWS;
    } else {
        type = SmsSession.Event.CBMessageType.OTHER;
    }
    SmsSession.Event.CBMessage cbm = new SmsSession.Event.CBMessage();
    cbm.msgFormat = format;
    cbm.msgPriority = priority + 1;
    cbm.msgType = type;
    cbm.serviceCategory = serviceCategory;
    cbm.serialNumber = serialNumber;
    cbm.deliveredTimestampMillis = deliveredTimestamp;
    smsSession.addEvent(new SmsSessionEventBuilder(SmsSession.Event.Type.CB_SMS_RECEIVED).setCellBroadcastMessage(cbm));
    finishSmsSessionIfNeeded(smsSession);
}