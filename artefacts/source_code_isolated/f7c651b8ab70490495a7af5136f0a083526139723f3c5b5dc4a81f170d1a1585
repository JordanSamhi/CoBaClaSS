public static int indexOfSubList(List<?> source, List<?> target){
    int sourceSize = source.size();
    int targetSize = target.size();
    int maxCandidate = sourceSize - targetSize;
    if (sourceSize < INDEXOFSUBLIST_THRESHOLD || (source instanceof RandomAccess && target instanceof RandomAccess)) {
        nextCand: for (int candidate = 0; candidate <= maxCandidate; candidate++) {
            for (int i = 0, j = candidate; i < targetSize; i++, j++) if (!eq(target.get(i), source.get(j)))
                continue nextCand;
            return candidate;
        }
    } else {
        ListIterator<?> si = source.listIterator();
        nextCand: for (int candidate = 0; candidate <= maxCandidate; candidate++) {
            ListIterator<?> ti = target.listIterator();
            for (int i = 0; i < targetSize; i++) {
                if (!eq(ti.next(), si.next())) {
                    for (int j = 0; j < i; j++) si.previous();
                    continue nextCand;
                }
            }
            return candidate;
        }
    }
    return -1;
}