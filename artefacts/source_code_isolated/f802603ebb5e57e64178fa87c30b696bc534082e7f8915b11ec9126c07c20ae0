public void write(boolean forceSync) throws XmlPullParserException, IOException{
    boolean hasAnyNewData = false;
    for (StoreFile sharedStoreFile : mSharedStores) {
        if (hasNewDataToSerialize(sharedStoreFile)) {
            byte[] sharedDataBytes = serializeData(sharedStoreFile);
            sharedStoreFile.storeRawDataToWrite(sharedDataBytes);
            hasAnyNewData = true;
        }
    }
    if (mUserStores != null) {
        for (StoreFile userStoreFile : mUserStores) {
            if (hasNewDataToSerialize(userStoreFile)) {
                byte[] userDataBytes = serializeData(userStoreFile);
                userStoreFile.storeRawDataToWrite(userDataBytes);
                hasAnyNewData = true;
            }
        }
    }
    if (hasAnyNewData) {
        if (forceSync) {
            writeBufferedData();
        } else {
            startBufferedWriteAlarm();
        }
    } else if (forceSync && mBufferedWritePending) {
        writeBufferedData();
    }
}