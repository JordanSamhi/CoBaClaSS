public static byte[] hidlMemoryToByteArray(@NonNull HidlMemory mem){
    Preconditions.checkNotNull(mem);
    Preconditions.checkArgumentInRange(mem.getSize(), 0L, (long) Integer.MAX_VALUE, "Memory size");
    Preconditions.checkArgument(mem.getSize() == 0 || mem.getName().equals("ashmem"), "Unsupported memory type: %s", mem.getName());
    if (mem.getSize() == 0) {
        return new byte[0];
    }
    ByteBuffer buffer = getBuffer(mem);
    byte[] result = new byte[buffer.remaining()];
    buffer.get(result);
    return result;
}