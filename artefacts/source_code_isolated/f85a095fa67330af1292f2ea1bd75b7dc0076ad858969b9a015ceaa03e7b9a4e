public int compareTo(URI that){
    int c;
    if ((c = compareIgnoringCase(this.scheme, that.scheme)) != 0)
        return c;
    if (this.isOpaque()) {
        if (that.isOpaque()) {
            if ((c = compare(this.schemeSpecificPart, that.schemeSpecificPart)) != 0)
                return c;
            return compare(this.fragment, that.fragment);
        }
        return +1;
    } else if (that.isOpaque()) {
        return -1;
    }
    if ((this.host != null) && (that.host != null)) {
        if ((c = compare(this.userInfo, that.userInfo)) != 0)
            return c;
        if ((c = compareIgnoringCase(this.host, that.host)) != 0)
            return c;
        if ((c = this.port - that.port) != 0)
            return c;
    } else {
        if ((c = compare(this.authority, that.authority)) != 0)
            return c;
    }
    if ((c = compare(this.path, that.path)) != 0)
        return c;
    if ((c = compare(this.query, that.query)) != 0)
        return c;
    return compare(this.fragment, that.fragment);
}