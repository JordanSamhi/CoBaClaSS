public synchronized void setMax(int max){
    if (mMinInitialized) {
        if (max < mMin) {
            max = mMin;
        }
    }
    mMaxInitialized = true;
    if (mMinInitialized && max != mMax) {
        mMax = max;
        postInvalidate();
        if (mProgress > max) {
            mProgress = max;
        }
        refreshProgress(R.id.progress, mProgress, false, false);
    } else {
        mMax = max;
    }
}